/* Global reset & safety */
*, *::before, *::after { box-sizing: border-box; }
html, body { overflow-x: hidden; }

:root {
  --bg: #f1f5f9;
  --card: #ffffff;
  --primary: #0f766e;
  --primary-hover: #14b8a6;
  --accent: #7c3aed;
  --danger: #ef4444;
  --text: #0f172a;
  --muted: #64748b;
  --radius: 12px;
}

body{
  font-family:'Inter', system-ui, sans-serif;
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding:0;
}

/* App container with robust gutters */
.app{
  max-width: 720px;
  margin-left: auto;
  margin-right: auto;

  /* vertical gutters */
  padding-top: 20px;
  padding-bottom: 130px; /* space for tab bar / tray */

  /* horizontal gutters live INSIDE the card */
  padding-left: max(20px, env(safe-area-inset-left));
  padding-right: max(20px, env(safe-area-inset-right));

  background: var(--card);
  border-radius: var(--radius);
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
  position: relative;
  z-index: 1;
}

/* Avoid 100vw to prevent scrollbar-induced shifts */
@supports (padding: max(0px)) {
  .app{
    width: min(
      720px,
      calc(100% - env(safe-area-inset-left) - env(safe-area-inset-right) - 40px)
    );
  }
}

h1 {
  margin-top: 0;
  font-size: 1.5rem;
  color: var(--primary);
}

.section-label {
  font-size: 1rem;
  font-weight: 600;
  margin: 16px 0 8px;
  color: var(--muted);
}

/* === Unified chips/badges look === */
.badge,
.section__badge,
.weekly-group__badge {
  background:#eef2ff;
  border-radius:999px;
  padding:4px 10px;
  font-size:.78rem;
  color:#0f172a;
  line-height:1;
}

.section__badge { margin-left: auto; }

/* --- Collapsible sections (Maaltijden / Weekboodschappen shells) --- */
details.section{
  border-radius:16px; border:1px solid #e2e8f0; background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.04); margin:14px 0 18px; overflow: hidden;
}
details.section > summary{
  list-style:none; cursor:pointer;
  padding:12px 14px; background:#eef2ff; border-bottom:1px solid #e2e8f0;
  font-weight:600; color:#0f172a; display:flex; align-items:center; gap:8px;
}
details.section > summary::-webkit-details-marker{ display:none; }
details.section[open] > summary{ background:#eaefff; }
.section__chev { font-weight:700; width:1.1em; text-align:center; }
.section__body { padding:14px; background:#fff; }

/* --- Meals row -> single line, horizontal scroll --- */
.meal-row{
  display:flex; gap:12px; margin:0; padding:10px 2px 4px;
  overflow-x:auto; flex-wrap:nowrap; scroll-snap-type:x proximity;
  -webkit-overflow-scrolling:touch;
}
.meal-row button{
  background:#0f766e; color:#fff;
  border:none; border-radius:16px;
  padding:12px 16px; font-weight:600;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
  min-width:128px; text-align:center;
  transition:transform .06s ease, background .2s ease, box-shadow .2s ease;
  scroll-snap-align:start;
}
.meal-row button:hover{ background:var(--primary-hover); }
.meal-row button:active{ transform:translateY(1px); }
.meal-row button.active{
  background:var(--accent);
  box-shadow:0 4px 14px rgba(124,58,237,.25);
}

/* nicer horizontal scrollbar under the meal row */
.meal-row::-webkit-scrollbar{ height:6px; }
.meal-row::-webkit-scrollbar-thumb{ background:#cbd5e1; border-radius:6px; }

/* Allow horizontal swipes in the meals row even inside the sheet */
.meal-row {
  touch-action: pan-x;
  overscroll-behavior-inline: contain;
}

/* Ensure the bottom sheet itself can scroll vertically */
.sheet__panel {
  overflow-y: auto;
}

/* --- Weekly accordion cards --- */
.weekly-accordion{ display:grid; gap:12px; }
.weekly-group{
  background:#fff; border:1px solid #e2e8f0;
  border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,.04);
  overflow:hidden;
}
.weekly-group__header{
  width:100%; display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:12px 14px; background:#eef2ff; border:none; cursor:pointer;
  font-size:1rem; font-weight:700; color:#0f172a;
}
.weekly-group__header.active{ background:#eaefff; }
.weekly-group__title{ display:flex; align-items:center; gap:10px; }

/* round chevron "chip" */
.weekly-group__chev{
  display:grid; place-items:center;
  width:26px; height:26px; border-radius:999px;
  background:rgba(15,23,42,.08);
  font-weight:800; font-size:.9rem; color:#0f172a;
  transition:background .2s ease, color .2s ease;
}
.weekly-group__header.active .weekly-group__chev{
  background:rgba(124,58,237,.15); color:var(--accent);
}

.weekly-group__content{ display:none; padding:12px; background:#fff; }
.weekly-group.open .weekly-group__content{ display:flex; flex-wrap:wrap; gap:10px; }
.weekly-group__content button{
  border:1px solid #e2e8f0; background:#fff; color:var(--text);
  border-radius:999px; padding:8px 14px; font-size:.9rem; font-weight:600;
  transition:background .2s ease, border-color .2s ease, transform .06s ease;
}
.weekly-group__content button:hover{ background:#f8fafc; }
.weekly-group__content button:active{ transform:translateY(1px); }
.weekly-group__content button.active{
  background:var(--accent); color:#fff; border-color:transparent;
  box-shadow:0 4px 12px rgba(124,58,237,.25);
}

/* --- Counters --- */
.counter { font-weight:500; margin:10px 0 8px; color:var(--muted); }

/* --- Shopping list --- */
.shopping-list { list-style: none; padding: 0; margin: 0; }

/* Top-level section wrapper (li.section in the shopping list) */
.shopping-list > li.section {
  display: block;
  padding: 0;
  margin: 12px 0;
  border: 0;
  background: transparent;
  box-shadow: none;
}

/* Section header (title + count) */
.section__header{
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 10px 6px;
}
.section__header h3{
  margin: 0;
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--text);
}
.section__count{
  margin-left: 12px;
  color: var(--muted);
  font-weight: 500;
  font-variant-numeric: tabular-nums;
}

/* Section items list */
.section__items { list-style: none; padding: 0 10px 6px; margin: 0; }

/* Only actual item rows are flexed */
.section__items > li.item-row{
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 4px;
  border-bottom: 1px solid #e2e8f0;
}
.section__items > li.item-row:last-child{ border-bottom: 0; }

/* (optional) hover just on rows, not on headers */
.section__items > li.item-row:hover{ background: #f8fafc; }

/* Remove the old generic styles if they’re still elsewhere */
.shopping-list small{ color: var(--muted); font-size: .75rem; }
.shopping-list li.crossed{ text-decoration: line-through; color: var(--muted); }

/* --- Custom input --- */
.custom-input{ display:flex; gap:8px; margin-top:20px; }
.custom-input input{
  flex:1; padding:8px 12px; border:1px solid #cbd5e1; border-radius:var(--radius);
  font-size:.9rem;
}
.custom-input button{
  background:var(--primary); color:#fff; border:none; border-radius:var(--radius);
  padding:8px 14px; cursor:pointer; font-size:.9rem;
}
.custom-input button:hover{ background:var(--primary-hover); }

/* --- Dialogs --- */
dialog{
  border:none; border-radius:var(--radius); padding:16px; width:90%; max-width:420px;
}
.add-form h3{ margin:0 0 8px; }
.add-form input{
  width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:10px; margin-bottom:8px;
}
.suggestions { 
  list-style: none; margin: 0; padding: 0 8px 8px; 
  display: flex; flex-wrap: wrap; gap: 8px;
}
.suggestions button{
  text-align:left; border:1px solid #e2e8f0; background:#fff; border-radius:8px; padding:8px 10px; cursor:pointer;
}
.suggestions button:hover{ background:#f8fafc; }
.actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
.actions button{ padding:8px 12px; border:none; border-radius:8px; }
#addConfirm{ background:var(--primary); color:#fff; }
#addCancel{ background:#e2e8f0; }
.suggestions li {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 999px;
  background: #fff;
  font-weight: 600;
}
/* The label part you tap to add */
.suggestions .chip-text {
  border: 0; background: transparent; padding: 0; margin: 0;
  cursor: pointer; font: inherit; color: inherit;
}

/* The star you tap to favorite (doesn't add) */
.suggestions .star {
  border: 0; background: transparent; padding: 0; margin: 0;
  cursor: pointer; font-size: 14px; line-height: 1; opacity: .55;
}
.suggestions .star.fav { opacity: 1; }
.suggestions .star:focus { outline: 2px solid var(--primary-hover); outline-offset: 2px; }

/* --- Tabs / pages --- */
.tabpage{ display:none; }
.tabpage.active{ display:block; }

/* --- Bottom tab bar --- */
.tabbar{
  position:fixed; left:0; right:0; bottom:0;
  background:#ffffff; border-top:1px solid #e2e8f0;
  display:grid; grid-template-columns:repeat(3, 1fr); gap:0; z-index:50;
}
.tabbar button{
  appearance:none; border:none; background:transparent;
  padding:10px 6px; font-size:.9rem; color:#475569;
  display:flex; flex-direction:column; align-items:center; gap:4px; cursor:pointer;
}
.tabbar button span{ font-size:1.1rem; line-height:1; }
.tabbar button.active{ color:var(--accent); font-weight:600; }

/* --- Recipes tab --- */
.recipes-toolbar{
  display:flex; justify-content:space-between; align-items:center; padding:12px 16px;
}
.recipes-grid{ display:grid; gap:12px; padding:0 16px 16px; }
.recipe-card{
  border:1px solid #e2e8f0; border-radius:12px; background:#fff; padding:12px;
  display:grid; gap:8px;
}
.recipe-card header{ display:flex; justify-content:space-between; align-items:center; gap:8px; }
.recipe-card .tags{ display:flex; flex-wrap:wrap; gap:6px; }
.recipe-card .tags span{
  background:#eef2ff; border-radius:999px; padding:2px 8px; font-size:.75rem; color:#0f172a;
}
.recipe-card .actions{ display:flex; gap:8px; justify-content:flex-end; }
.btn{ border:none; border-radius:8px; padding:6px 10px; cursor:pointer; font-size:.9rem; }
.btn.primary{ background:var(--primary); color:#fff; }
.btn.ghost{ background:#e2e8f0; color:#0f172a; }
.btn.danger{ background:var(--danger); color:#fff; }

/* Recipe editor dialog */
#recipeDialog{ border:none; border-radius:12px; padding:16px; width:90%; max-width:520px; }
.recipe-form{ display:grid; gap:10px; }
.recipe-form input, .recipe-form textarea{
  width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:10px; font-size:.95rem;
}
.ing-suggestions{ display:grid; gap:6px; max-height:180px; overflow:auto; }
.ing-suggestions button{
  text-align:left; border:1px solid #e2e8f0; background:#fff; border-radius:8px; padding:6px 10px; cursor:pointer;
}
.ing-suggestions button:hover{ background:#f8fafc; }
.recipe-dialog-actions{ display:flex; gap:8px; justify-content:flex-end; }

/* --- Stores tab polish --- */
.stores-wrap{ padding:16px; }
.stores-header{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  margin:6px 0 12px;
}
.stores-header h2{ margin:0; display:flex; align-items:center; gap:8px; }
.stores-grid{ display:grid; gap:12px; padding:0; }
.store-card{ border:1px solid #e2e8f0; border-radius:12px; background:#fff; padding:12px; }
.store-card header{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px; }
.store-card .actions{ display:flex; gap:8px; flex-wrap:wrap; }
.btn.sm{ padding:6px 12px; font-size:.9rem; }

/* --- Unified floating actions tray --- */
.fab-tray{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(72px + env(safe-area-inset-bottom));
  display: flex;
  gap: 12px;
  padding: 8px;
  border: 1px solid #e2e8f0;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(6px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  z-index: 200;
}

/* A11y helpers */
.sr-only{
  position:absolute; width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
}

/* Snackbar */
#snackbar{
  position: fixed;
  left: 0; right: 0; bottom: calc(72px + env(safe-area-inset-bottom));
  display: flex;
  justify-content: center;
  z-index: 300;
  pointer-events: none;
}
.snackbar{
  pointer-events: all;
  display: inline-flex;
  gap: 16px;
  align-items: center;
  background: rgba(17, 24, 39, 0.95);
  color: #fff;
  border-radius: 10px;
  padding: 10px 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.22);
  max-width: 92vw;
}
.snackbar__label{ font-size: .95rem; }
.snackbar__btn{
  border: none;
  background: transparent;
  color: #fff;
  text-decoration: underline;
  font-weight: 600;
  cursor: pointer;
}
/* ===== Bottom Sheet (STEP-2) ===== */
#composer {
  position: fixed;
  inset: 0;
  z-index: 350;
  pointer-events: none; /* disabled until open */
}

#composer.open {
  pointer-events: auto;
}

.sheet__scrim {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.35);
  opacity: 0;
  transition: opacity 160ms ease;
}

#composer.open .sheet__scrim { opacity: 1; }

.sheet__panel {
  position: absolute;
  left: 0; right: 0; bottom: 0;
  background: var(--card, #fff);
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
  box-shadow: 0 -8px 30px rgba(0,0,0,0.15);
  transform: translateY(100%);
  transition: transform 220ms ease;
  padding: 12px 16px 16px;
  max-height: 85vh;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 10px;
  overflow-x: hidden;     /* block horizontal scroll on the panel */
  overflow-y: auto;       /* keep normal vertical scrolling */
}

/* Make only the meals row a horizontal scroller */
#mealRowModal {
  display: flex;
  flex-wrap: nowrap;      /* keep chips on one line */
  gap: 12px;
  overflow-x: auto;       /* enable horizontal scroll here */
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;  /* smooth iOS scrolling */
  touch-action: pan-x;                 /* capture horizontal swipes */
  overscroll-behavior-inline: contain; /* prevent scroll chaining to parent */
  scroll-snap-type: x proximity;       /* optional: gentle snapping */
}

/* Each chip is a snap target and won’t shrink */
#mealRowModal .chip {
  flex: 0 0 auto;
  scroll-snap-align: start;
}

#composer.open .sheet__panel { transform: translateY(0%); }

.sheet__handle {
  width: 40px;
  height: 4px;
  background: var(--border, #e2e8f0);
  border-radius: 999px;
  margin: 6px auto 6px;
}

.sheet__form input#addInput {
  width: 100%;
  border: 1px solid var(--border, #e2e8f0);
  border-radius: var(--radius, 12px);
  padding: 10px 12px;
  font-size: 16px;
  outline: none;
}

#modalSuggestions { padding: 8px 0; }
.suggestions {
  list-style: none;
  margin: 0;
  padding: 0 8px 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.suggestions li {
  padding: 8px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 999px;
  background: #fff;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
}
.suggestions li:active { transform: translateY(1px); }
.suggestions li:hover { background: #f8fafc; }

.sheet__actions {
  position: sticky;
  bottom: 0;
  background: linear-gradient(to top, var(--card), rgba(255,255,255,0.85) 60%, transparent);
  padding-top: 8px;
  margin-top: 8px;
  /* Optional small border hint */
  border-top: 1px solid #e2e8f0;
}

.btn { padding: 8px 12px; border-radius: 10px; border: 1px solid transparent; cursor: pointer; }
.btn-primary { background: var(--primary, #0f766e); color: #fff; }
.btn-primary:hover { background: var(--primary-hover, #14b8a6); }
.btn-ghost { background: transparent; border-color: var(--border, #e2e8f0); color: var(--text, #0f172a); }

/* Screen-reader only utility (if not present yet) */
.sr-only {
  position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden;
  clip: rect(0,0,0,0); white-space: nowrap; border: 0;
}
/* Suggestion chips for recents */
.suggestions {
  list-style: none;
  margin: 8px 0 0;
  padding: 0;
  max-height: 40vh;
  overflow: auto;
}

.suggestions li {
  padding: 8px 10px;
  border-radius: 10px;
  cursor: pointer;
}

.suggestions li:hover { background: #f8fafc; }

.suggestions li.suggestion-chip {
  display: inline-block;
  margin: 4px 6px 0 0;
  padding: 6px 10px;
  border: 1px solid var(--border, #e2e8f0);
  border-radius: 999px;
  background: #fff;
}
.suggestions li.suggestion-chip:hover {
  background: #f8fafc;
}
/* ===== STEP-4: parsed chips (inline tokens) ===== */
.parsed-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}

.parsed-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border: 1px solid var(--border, #e2e8f0);
  border-radius: 999px;
  background: #fff;
  font-size: 14px;
  line-height: 1;
}

.parsed-chip .key {
  color: var(--muted, #64748b);
}

.parsed-chip button {
  border: 0;
  background: transparent;
  cursor: pointer;
  padding: 0;
  text-decoration: underline;
  font-weight: 600;
}

/* Tiny select popup */
.parsed-select {
  position: relative;
}
.parsed-select select {
  border: 1px solid var(--border, #e2e8f0);
  border-radius: 8px;
  padding: 4px 6px;
  background: #fff;
  font-size: 14px;
}

/* ===== STEP-6: item row controls ===== */
.item-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 4px;
}

.item-row__main { min-width: 0; }
.item-row__actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-qty {
  border: 1px solid var(--border, #e2e8f0);
  background: #fff;
  border-radius: 8px;
  width: 32px; height: 32px;
  font-size: 18px;
  line-height: 30px;
  padding: 0;
  cursor: pointer;
}
.btn-qty:hover { background: #f8fafc; }

.item-row .qty {
  min-width: 20px;
  text-align: center;
  font-variant-numeric: tabular-nums;
}

/* Overflow (⋮) */
.btn-overflow {
  border: 1px solid var(--border, #e2e8f0);
  background: #fff;
  border-radius: 8px;
  width: 32px; height: 32px;
  line-height: 30px;
  font-size: 18px;
  padding: 0;
  cursor: pointer;
}

.overflow { position: relative; }

.overflow .menu {
  position: absolute;
  right: 0; top: 36px;
  background: #fff;
  border: 1px solid var(--border, #e2e8f0);
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  min-width: 160px;
  z-index: 20;
}
.overflow .menu[hidden] { display: none; }

.menu__item {
  width: 100%;
  text-align: left;
  border: 0;
  background: transparent;
  padding: 10px 12px;
  cursor: pointer;
}
.menu__item:hover { background: #f8fafc; }
.menu__item.delete { color: #b91c1c; }

/* --- Fix: bottom sheet gutters + horizontal scroller in meals --- */
#composer .sheet__panel{
  /* keep the grid layout + vertical scroll */
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 10px;
  max-height: 85vh;
  overflow-y: auto;
  /* force gutters on first open (mobile) */
  padding: 12px 16px 16px !important;
  /* block any accidental X scroll on the panel itself */
  overflow-x: hidden !important;
}

/* Make sure grid children can shrink to container on small screens */
#modalMeals,
#modalSuggestions,
#composer .sheet__form { min-width: 0; }

/* Horizontal chips row: one line, its own scroller */
#mealRowModal{
  display: flex;
  flex-wrap: nowrap;
  gap: 12px;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-x;
  overscroll-behavior-inline: contain;
  scroll-snap-type: x proximity;
  padding: 8px 2px 4px;   /* tiny inner breathing room */
}

/* Chips shouldn’t shrink; give them a sensible base width */
#mealRowModal .chip{
  flex: 0 0 auto;
  min-width: 120px;
  scroll-snap-align: start;
}

/* gentle side padding for section blocks inside the sheet */
#modalMeals .section-label,
#modalSuggestions,
#composer .sheet__form { padding-left: 2px; padding-right: 2px; }

/* Clear-list as an inline action at the bottom of the list */
.clear-list {
  position: static;           /* not fixed */
  display: block;
  width: 100%;
  margin: 16px 0 8px;
  padding: 10px 12px;
  border: 1px solid #e2e8f0;
  border-radius: var(--radius);
  background: transparent;
  color: var(--muted);
  font-weight: 600;
  text-align: center;
  box-shadow: none;
}
.clear-list:hover { background:#f8fafc; color: var(--text); }

/* Floating Action Button (FAB) — fixed bottom-right */
.fab {
  position: fixed !important;
  right: 16px;
  bottom: calc(72px + env(safe-area-inset-bottom) + 16px); /* above tabbar */
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  border: none;
  background: var(--primary);
  color: #fff;
  font-size: 28px;
  line-height: 1;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 1100; /* above tabbar & list */
}
.fab:hover { background: var(--primary-hover); }
.fab:focus { outline: 2px solid var(--primary-hover); outline-offset: 2px; }
